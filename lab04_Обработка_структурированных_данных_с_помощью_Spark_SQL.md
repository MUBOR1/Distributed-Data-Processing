# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ4: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é Spark SQL

## –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã
–û—Å–≤–æ–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º–∏ API Apache Spark ‚Äî Spark SQL –∏ DataFrames. –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–æ–º–æ—â—å—é SQL-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∏ DataFrame API, –∞ —Ç–∞–∫–∂–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –±–∞–∑–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö.

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ß–∞—Å—Ç—å 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ Spark –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```python
spark = SparkSession.builder.appName("Lab4").getOrCreate()
employees_df = spark.read.option("header", "true").option("inferSchema", "true").csv("file:///home/clay/spark_lab4/employees.csv")
departments_df = spark.read.option("multiline", "true").json("file:///home/clay/spark_lab4/departments.json")
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Spark —Å–µ—Å—Å–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞
–ó–∞–≥—Ä—É–∂–µ–Ω–æ 10 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ CSV —Ñ–∞–π–ª–∞
–ó–∞–≥—Ä—É–∂–µ–Ω–æ 1 –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∏–∑ JSON —Ñ–∞–π–ª–∞
```

![–°–ö–†–ò–ù–®–û–¢ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö](./image/lb4startsession.png)

üì∑ *[–°–ö–†–ò–ù–®–û–¢ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö]*

```
–°—Ö–µ–º–∞ employees_df:
root
 |-- id: integer (nullable = true)
 |-- name: string (nullable = true)
 |-- department: string (nullable = true)
 |-- salary: integer (nullable = true)

–°—Ö–µ–º–∞ departments_df:
root
 |-- dep_id: string (nullable = true)
 |-- dep_name: string (nullable = true)
 |-- location: string (nullable = true)
 ```

 ### –ß–∞—Å—Ç—å 2: –†–∞–±–æ—Ç–∞ —Å DataFrame API
 #### 2.1 –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
 ***–ö–æ–¥:***

 ```python
 employees_df.show(5)
departments_df.show(5)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–ü–µ—Ä–≤—ã–µ 5 –∑–∞–ø–∏—Å–µ–π employees_df:
+---+---------+----------+------+
| id|     name|department|salary|
+---+---------+----------+------+
|  1|   Ivanov|        IT| 75000|
|  2|   Petrov|        HR| 50000|
|  3|  Sidorov|        IT| 80000|
|  4|  Smirnov|     Sales| 60000|
|  5|Kuznetsov|        HR| 55000|
+---+---------+----------+------+

–ü–µ—Ä–≤—ã–µ 5 –∑–∞–ø–∏—Å–µ–π departments_df:
+------+--------------------+--------+
|dep_id|            dep_name|location|
+------+--------------------+--------+
|    IT|Information Techn...| Floor 3|
+------+--------------------+--------+
```

![–°–ö–†–ò–ù–®–û–¢ 2: –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ DataFrame API](./image/lb4DataFrame.png)

üì∑ *[–°–ö–†–ò–ù–®–û–¢ 2: –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ DataFrame API]*

#### 2.2 –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
***–ö–æ–¥:***

```python
high_salary = employees_df.filter(col("salary") > 50000)
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å –∑–∞—Ä–ø–ª–∞—Ç–æ–π –≤—ã—à–µ 50000:
+---+---------+----------+------+
| id|     name|department|salary|
+---+---------+----------+------+
|  1|   Ivanov|        IT| 75000|
|  3|  Sidorov|        IT| 80000|
|  4|  Smirnov|     Sales| 60000|
|  5|Kuznetsov|        HR| 55000|
|  6|    Popov|        IT| 90000|
|  8|  Fedorov|        IT| 70000|
| 10|  Nikitin|     Sales| 65000|
+---+---------+----------+------+
```

![–°–ö–†–ò–ù–®–û–¢ 3: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö](./image/lb4filterdata.png)

üì∑ *[–°–ö–†–ò–ù–®–û–¢ 3: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö]*

#### 2.3 –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è
***–ö–æ–¥:***

```python
avg_salary_by_dept = employees_df.groupBy("department").agg(avg("salary").alias("avg_salary")).orderBy(desc("avg_salary"))
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–°—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –ø–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞–º:
+----------+------------------+
|department|        avg_salary|
+----------+------------------+
|        IT|           78750.0|
|     Sales|56666.666666666664|
|        HR|           51000.0|
+----------+------------------+
```

![–°–ö–†–ò–ù–®–û–¢ 4: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è](./image/lb4groupdata.png)

üì∑ *[–°–ö–†–ò–ù–®–û–¢ 4: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è]*

#### 2.4 JOIN-–æ–ø–µ—Ä–∞—Ü–∏–∏
***–ö–æ–¥:***
```python
employees_with_dept = employees_df.join(departments_df, employees_df.department == departments_df.dep_id)
employee_count_by_dept = employees_with_dept.groupBy("dep_name").agg(count("id").alias("employee_count"))
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
JOIN —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤:
+---+-------+----------+--------------------+------+
| id|   name|department|            dep_name|salary|
+---+-------+----------+--------------------+------+
|  1| Ivanov|        IT|Information Techn...| 75000|
|  3|Sidorov|        IT|Information Techn...| 80000|
|  6|  Popov|        IT|Information Techn...| 90000|
|  8|Fedorov|        IT|Information Techn...| 70000|
+---+-------+----------+--------------------+------+

–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –∫–∞–∂–¥–æ–º –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–µ:
+--------------------+--------------+
|            dep_name|employee_count|
+--------------------+--------------+
|Information Techn...|             4|
+--------------------+--------------+

–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: Information Technology (4 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤)
```
![–°–ö–†–ò–ù–®–û–¢ 5: JOIN-–æ–ø–µ—Ä–∞—Ü–∏–∏](./image/lb4join.png)

üì∑ *[–°–ö–†–ò–ù–®–û–¢ 5: JOIN-–æ–ø–µ—Ä–∞—Ü–∏–∏]*

### –ß–∞—Å—Ç—å 3: –†–∞–±–æ—Ç–∞ —Å Spark SQL
#### 3.1 –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
***–ö–æ–¥:***
```python
employees_df.createOrReplaceTempView("employees")
departments_df.createOrReplaceTempView("departments")
```

#### 3.2 SQL-–∑–∞–ø—Ä–æ—Å: 3 —Å–∞–º—ã—Ö –≤—ã—Å–æ–∫–æ–æ–ø–ª–∞—á–∏–≤–∞–µ–º—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
***–ö–æ–¥:***
```sql
SELECT name, department, salary 
FROM employees 
ORDER BY salary DESC 
LIMIT 3
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
3 —Å–∞–º—ã—Ö –≤—ã—Å–æ–∫–æ–æ–ø–ª–∞—á–∏–≤–∞–µ–º—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:
+-------+----------+------+
|   name|department|salary|
+-------+----------+------+
|  Popov|        IT| 90000|
|Sidorov|        IT| 80000|
| Ivanov|        IT| 75000|
+-------+----------+------+
```
![–°–ö–†–ò–ù–®–û–¢ 6: SQL-–∑–∞–ø—Ä–æ—Å - —Ç–æ–ø-3 –∑–∞—Ä–ø–ª–∞—Ç—ã](./image/lb4top3.png)

üì∑ *[–°–ö–†–ò–ù–®–û–¢ 6: SQL-–∑–∞–ø—Ä–æ—Å - —Ç–æ–ø-3 –∑–∞—Ä–ø–ª–∞—Ç—ã]*

#### 3.3 SQL-–∑–∞–ø—Ä–æ—Å: –§–æ–Ω–¥ –æ–ø–ª–∞—Ç—ã —Ç—Ä—É–¥–∞ –ø–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞–º
***–ö–æ–¥:***
```sql
SELECT 
    e.department,
    d.dep_name,
    SUM(e.salary) as total_salary
FROM employees e
JOIN departments d ON e.department = d.dep_id
GROUP BY e.department, d.dep_name
ORDER BY total_salary DESC
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–§–æ–Ω–¥ –æ–ø–ª–∞—Ç—ã —Ç—Ä—É–¥–∞ –ø–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞–º:
+----------+--------------------+------------+
|department|            dep_name|total_salary|
+----------+--------------------+------------+
|        IT|Information Techn...|      315000|
+----------+--------------------+------------+
```
![–°–ö–†–ò–ù–®–û–¢ 7: SQL-–∑–∞–ø—Ä–æ—Å - —Ñ–æ–Ω–¥ –æ–ø–ª–∞—Ç—ã —Ç—Ä—É–¥–∞](./image/lb4fondtips.png)

üì∑ *[–°–ö–†–ò–ù–®–û–¢ 7: SQL-–∑–∞–ø—Ä–æ—Å - —Ñ–æ–Ω–¥ –æ–ø–ª–∞—Ç—ã —Ç—Ä—É–¥–∞]*

#### 3.4 SQL-–∑–∞–ø—Ä–æ—Å: –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å –∑–∞—Ä–ø–ª–∞—Ç–æ–π –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–π –ø–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—É
***–ö–æ–¥:***
```sql
SELECT 
    e.name,
    e.department,
    e.salary,
    dept_avg.avg_salary
FROM employees e
JOIN (
    SELECT department, AVG(salary) as avg_salary
    FROM employees
    GROUP BY department
) dept_avg ON e.department = dept_avg.department
WHERE e.salary > dept_avg.avg_salary
ORDER BY e.department, e.salary DESC
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å –∑–∞—Ä–ø–ª–∞—Ç–æ–π –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–π –ø–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—É:
+---------+----------+------+------------------+
|     name|department|salary|        avg_salary|
+---------+----------+------+------------------+
|Kuznetsov|        HR| 55000|           51000.0|
|    Popov|        IT| 90000|           78750.0|
|  Sidorov|        IT| 80000|           78750.0|
|  Nikitin|     Sales| 65000|56666.666666666664|
|  Smirnov|     Sales| 60000|56666.666666666664|
+---------+----------+------+------------------+
```
![–°–ö–†–ò–ù–®–û–¢ 8: SQL-–∑–∞–ø—Ä–æ—Å - –∑–∞—Ä–ø–ª–∞—Ç–∞ –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–π](./image/lb4sqlpost.png)

üì∑ *[–°–ö–†–ò–ù–®–û–¢ 8: SQL-–∑–∞–ø—Ä–æ—Å - –∑–∞—Ä–ø–ª–∞—Ç–∞ –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–π]*

### –ß–∞—Å—Ç—å 4: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
***–ö–æ–¥:***
```python
dept_stats = spark.sql("""
    SELECT 
        d.dep_name as department_name,
        COUNT(e.id) as employee_count,
        ROUND(AVG(e.salary), 2) as avg_salary,
        SUM(e.salary) as total_salary
    FROM employees e
    JOIN departments d ON e.department = d.dep_id
    GROUP BY d.dep_name
    ORDER BY avg_salary DESC
""")
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞–º –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:
+--------------------+--------------+----------+------------+
|     department_name|employee_count|avg_salary|total_salary|
+--------------------+--------------+----------+------------+
|Information Techn...|             4|   78750.0|      315000|
+--------------------+--------------+----------+------------+

–¢–ï–ö–°–¢–û–í–ê–Ø –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø –†–ï–ó–£–õ–¨–¢–ê–¢–û–í:

–°—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –ø–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞–º:
  Information Technology: $78,750

–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞–º:
  Information Technology: 4 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

–û–±—â–∏–π —Ñ–æ–Ω–¥ –æ–ø–ª–∞—Ç—ã —Ç—Ä—É–¥–∞:
  Information Technology: $315,000
```  

![–°–ö–†–ò–ù–®–û–¢ 9: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏](./image/lb4finish.png)

üì∑ *[–°–ö–†–ò–ù–®–û–¢ 9: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏]*

## –û—Ç–≤–µ—Ç—ã –Ω–∞ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã
### 1. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Spark SQL –ø–µ—Ä–µ–¥ —Ä–∞–±–æ—Ç–æ–π —Å RDD
#### Spark SQL –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å RDD:

1. –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Catalyst Optimizer –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ Tungsten Engine –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
2. –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–ª–∞–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
3. SQL-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞–∫–æ–º—ã–π SQL-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
4. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: –†–∞–±–æ—Ç–∞–µ—Ç —Å –¥–∞–Ω–Ω—ã–º–∏, –∏–º–µ—é—â–∏–º–∏ —Å—Ö–µ–º—É, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ª—É—á—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã (JSON, CSV, Parquet, JDBC)
6. Type safety: –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤ DataFrames –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è


### 2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ DataFrame API –∏ Spark SQL
***–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:***
**–í –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–µ –æ–±–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –ø–æ–∫–∞–∑–∞–ª–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ç–∞–∫ –∫–∞–∫:**

- DataFrame API –∏ Spark SQL –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä (Catalyst)
- –û–±–∞ –ø–æ–¥—Ö–æ–¥–∞ –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è –≤ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –†–∞–∑–Ω–∏—Ü–∞ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞ –∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–ª—É—á–∞—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

***–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã:***
- –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ SQL –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º
- DataFrame API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–æ–ª–µ–µ –≥–∏–±–∫–∏–π –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –í—ã–±–æ—Ä –º–µ–∂–¥—É –Ω–∏–º–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏

### 3. –†–∞–±–æ—Ç–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞ Catalyst
**Catalyst Optimizer - —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ Spark SQL, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
1. **–ê–Ω–∞–ª–∏–∑ (Analysis):**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å SQL –∑–∞–ø—Ä–æ—Å–∞
- –†–∞–∑—Ä–µ—à–∞–µ—Ç –∏–º–µ–Ω–∞ —Å—Ç–æ–ª–±—Ü–æ–≤ –∏ —Ç–∞–±–ª–∏—Ü
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

2. **–õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (Logical Optimization):**
- –ü—Ä–∏–º–µ–Ω–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–ø—Ä–µ–¥–∏–∫–∞—Ç pushdown, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
- –£–ø—Ä–æ—â–∞–µ—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏—è
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–ª–∞–Ω—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

3. **–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (Physical Planning):**
- –í—ã–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ (Code Generation):**
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –±–∞–π—Ç-–∫–æ–¥ Java –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–¥—Ö–æ–¥ "whole-stage code generation"

**–ü—Ä–∏–º–µ—Ä –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã:**
- –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ JOIN –æ–ø–µ—Ä–∞—Ü–∏–∏ Catalyst –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –Ω–∞ —Ä–∞–Ω–Ω–∏—Ö —ç—Ç–∞–ø–∞—Ö –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –æ–±—ä–µ–º–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö.